---
title: Node.js 环境变量设置
date: 2017-08-29 10:24:54
updated: 2017-08-29 10:24:54
categories: Node.js
---


环境变量是操作系统运行环境的一些参数。在开发环境或者部署环境中都需要使用到。  
本文讲述了使用命令行临时对环境变量的查看、添加、修改和删除。和修改系统文件来永久设置环境变量的方法。


## 一、Windows 设置环境变量

### 临时(cmd)

查看环境变量，添加环境变量，删除环境变量

```bash
#node中常用的到的环境变量是NODE_ENV，首先查看是否存在
set NODE_ENV
#如果不存在则添加环境变量
set NODE_ENV=production
#环境变量追加值
set 变量名=%变量名%;变量内容
set path=%path%;C:\web;C:\Tools
#某些时候需要删除环境变量
set NODE_ENV=
```

### 临时(powershell)

查看环境变量，添加环境变量，删除环境变量

```bash
#node中常用的到的环境变量是NODE_ENV，首先查看是否存在
$env:NODE_ENV
#如果不存在则添加环境变量
$env:NODE_ENV="production"
#环境变量追加值
$env:path=$env:path + ";C:\web;C:\Tools"
#某些时候需要删除环境变量
del env:NODE_ENV
#某些时候需要显示所有的环境变量
ls env:
```

### 永久

右键(此电脑) -> 属性(R) -> 高级系统设置 -> 环境变量(N)...

## 二、Linux 设置环境变量

### 临时

查看环境变量，添加环境变量，删除环境变量

```bash
#node中常用的到的环境变量是NODE_ENV，首先查看是否存在
echo $NODE_ENV
#如果不存在则添加环境变量
export NODE_ENV=production
#环境变量追加值
export path=$path:/home/download:/usr/local/
#某些时候需要删除环境变量
unset NODE_ENV
#某些时候需要显示所有的环境变量
env
```

### 永久

系统文件的读取顺序和位置如下：

```bash
# 所有用户
/etc/profile
# 当前用户
~/.bash_profile
```

在文件末尾添加类似如下语句进行环境变量的设置或修改

```bash
# 在文件末尾添加如下格式的环境变量
export path=$path:/home/download:/usr/local/
```

修改完成后需要运行如下语句令系统重新加载

```bash
# 修改/etc/profile文件后
source /etc/profile
# 修改~/.bash_profile文件后
source .bash_profile
```

## 三、MacOS 设置环境变量

### 临时

查看环境变量，添加环境变量，删除环境变量

```bash
#node中常用的到的环境变量是NODE_ENV，首先查看是否存在
echo $NODE_ENV
#如果不存在则添加环境变量
export NODE_ENV=production
#环境变量追加值
export PATH=$PATH:/home/download:/usr/local/
#某些时候需要删除环境变量
unset NODE_ENV
#某些时候需要显示所有的环境变量
env
```

### 永久

系统文件的读取顺序和位置如下：

```bash
# 所有用户
/etc/profile
# 当前用户
~/.bash_profile
```

在文件末尾添加类似如下语句进行环境变量的设置或修改

```bash
# 在文件末尾添加如下格式的环境变量
export PATH=$PATH:/home/download:/usr/local/
```

修改完成后需要运行如下语句令系统重新加载

```bash
# 修改/etc/profile文件后
source /etc/profile
# 修改~/.bash_profile文件后
source .bash_profile
```

## Node.js package.json 中设置实例
```bash
// ...
"scripts": {
	// windows 中设置环境变量
  "dev:pm2:124": "set SERVER_TYPE=124&&pm2 start pm2-processes.json",
	
	// linux 中设置环境变量
  "start:pm2:ali": "export SERVER_TYPE=ali&&pm2 start ./src/server.js"
}
// ...
```

## 四、Cross-env
如果是 node.js 环境可以通过安装 `[cross-env](https://www.npmjs.com/package/cross-spawn)` 插件解决设置环境变量的跨平台问题
### 1. 安装
```bash
npm i cross-env -save
```

### 2. 在 package.json 中使用
```js
{
  "scripts": {
    "parentScript": "cross-env NAME=\"jesse\" npm run childScript",
    "childScript": "echo Hello $NAME"
  }
}
//...
console.log(process.env.NAME);// jesse
```
注意：使用 `cross-env` 只能设置一个环境变量值，如果设置多个，则只有第一个有效
```js
{
  "scripts": {
    "parentScript": "cross-env NAME=\"jesse\" AGE=18 npm run childScript",
    "childScript": "echo Hello $NAME"
  }
}
console.log(process.env.NAME,process.env.AGE);// jesse undefined
```

### 3. 设置环境为对象解决不能传人多值问题
```js
{
  "scripts": {
    "parentScript": "ENV_OPTION={\\\"name\\\":\\\"jesse\\\",\\\"age\\\":18} npm run childScript",
    "childScript": "echo Hello $NAME"
  }
}
console.log(process.env.ENV_OPTION);// {"name":"jesse","age":18} typeof: string
```
注意：设置的值在 `process.env.xxxx` 取到的都是字符串类型。

## 参考
- [环境变量](http://www.cnblogs.com/sorex/p/6200940.html)